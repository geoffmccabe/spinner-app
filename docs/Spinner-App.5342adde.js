document.addEventListener("DOMContentLoaded",()=>{let e=[],t=0,i=null,n=0,a=document.getElementById("spinnerCanvas"),l=a.getContext("2d"),o=document.getElementById("canvasMessage"),r=document.getElementById("objectSelectorContainer"),d=document.getElementById("imageUpload"),s=document.getElementById("removeImageButton"),m=document.getElementById("degreesPerFrame"),g=document.getElementById("finalVerticalSize"),c=document.getElementById("opacity"),u=document.getElementById("totalExportFrames"),f=document.getElementById("frameTime"),p=document.getElementById("webpCompression"),b=document.getElementById("exportButton"),h=document.getElementById("loadingIndicator"),y=document.getElementById("exportMessage");function v(){r.innerHTML="",e.forEach(e=>{let t=document.createElement("div");t.classList.add("object-button-container");let i=document.createElement("button");i.textContent=e.name+(e.image?" ✓":""),i.classList.add("object-button","p-2","border","border-slate-300","rounded-md","text-sm"),e.image&&i.classList.add("font-semibold"),i.addEventListener("click",()=>w(e.id));let n=document.createElement("span");n.classList.add("object-file-name"),n.textContent=e.fileName||"(empty)",t.appendChild(i),t.appendChild(n),r.appendChild(t)}),P()}function P(){let i=r.querySelectorAll(".object-button"),n=r.querySelectorAll(".object-file-name");i.forEach((i,a)=>{i.classList.toggle("active",a===t);let l=e[a];i.textContent=l.name+(l.image?" ✓":""),l.image?i.classList.add("font-semibold"):i.classList.remove("font-semibold"),n[a]&&(n[a].textContent=l.fileName||"(empty)")})}function w(i){t=i,function(){let i=e[t];m.value=i.settings.degreesPerFrame,g.value=i.settings.finalVerticalSize||"",c.value=i.settings.opacity}(),P(),s.disabled=!e[t].image,b.disabled=!e.some(e=>e.image)||"undefined"==typeof WebP||void 0===WebP.Encoder,E()}function E(){l.clearRect(0,0,a.width,a.height);let i=!1;for(let n=5;n>=0;n--){let o=e[n];if(!o.image)continue;i=!0;let r=o.settings.finalVerticalSize||o.originalHeight;r<=0&&(r=o.originalHeight);let d=o.originalWidth>0&&o.originalHeight>0?o.originalWidth/o.originalHeight:1,s=r*d;if((s>1580||r>1580)&&(d>=1?(s=1580,r=1580/d):(r=1580,s=1580*d)),l.save(),l.globalAlpha=o.settings.opacity/100,n===t){let e=(a.width-s)/2,t=(a.height-r)/2,i=l.globalAlpha;l.globalAlpha=1,l.strokeStyle="#CCCCCC",l.lineWidth=2,l.strokeRect(e,t,s,r),l.globalAlpha=i}l.translate(a.width/2,a.height/2),l.rotate(o.livePreviewRotationAngle*Math.PI/180),l.drawImage(o.image,-s/2,-r/2,s,r),l.restore()}l.globalAlpha=1,!i&&t>=0?o.textContent=`${e[t].name} is empty. Upload an image.`:i&&t>=0?o.textContent=`Previewing. Settings for ${e[t].name}.`:o.textContent="Select an object and upload an image."}function x(t){let a=parseFloat(f.value)||83.3,l=t-n;if(l>=a){n=t-l%a;let i=!1;e.forEach(e=>{if(e.image){let t=e.settings.degreesPerFrame||0;if(0!==t){for(e.livePreviewRotationAngle=e.livePreviewRotationAngle+t;e.livePreviewRotationAngle>=360;)e.livePreviewRotationAngle-=360;for(;e.livePreviewRotationAngle<0;)e.livePreviewRotationAngle+=360;i=!0}else 0!==e.livePreviewRotationAngle&&0===t&&(i=!0)}}),(i||e.some(e=>e.image&&0===e.settings.degreesPerFrame))&&E()}e.some(e=>e.image)?i=requestAnimationFrame(x):(i=null,E())}function C(){i&&(cancelAnimationFrame(i),i=null),e.some(e=>e.image)?(n=performance.now(),i=requestAnimationFrame(x)):E()}("undefined"==typeof WebP||void 0===WebP.Encoder)&&(console.error("WebP-WASM library (WebP.Encoder) not loaded correctly. Animated WebP export will not work. Ensure 'webp-wasm.js' is present and correct in the same directory as index.html if using local file, or that the library is correctly installed via npm and bundled by Parcel."),y.innerHTML="<span class='text-red-500 font-bold'>CRITICAL ERROR: WebP encoding library not found or failed to load. Animated export is disabled.</span><br><small>If using local setup, ensure 'webp-wasm.js' is correctly placed. If using npm, ensure 'webp-wasm' is installed and Parcel is bundling correctly.</small>",b&&(b.disabled=!0)),d.addEventListener("change",i=>{let a=i.target.files[0],l=e[t];if(l&&a){if(l.fileName=a.name,"image/png"===a.type||"image/gif"===a.type||"image/webp"===a.type||"image/jpeg"===a.type){let i=new FileReader;i.onload=i=>{l.image=new Image,l.image.onload=()=>{l.originalWidth=l.image.width,l.originalHeight=l.image.height,(null===l.settings.finalVerticalSize||""===l.settings.finalVerticalSize)&&(l.settings.finalVerticalSize=l.originalHeight,t===e.findIndex(e=>e===l)&&(g.value=l.settings.finalVerticalSize)),o.textContent=`${l.name} ('${l.fileName}') loaded.`,l.livePreviewRotationAngle=0,n=performance.now(),C(),v(),s.disabled=!1,b.disabled="undefined"==typeof WebP||void 0===WebP.Encoder},l.image.onerror=()=>{l.fileName=null,o.textContent=`Error loading ${a.name}.`,v()},l.image.src=i.target.result},i.readAsDataURL(a)}else l.fileName=null,o.textContent=`Unsupported file type for ${a.name}.`,v();d.value=""}}),s.addEventListener("click",()=>{let i=e[t];i&&i.image&&(i.image=null,i.fileName=null,i.originalWidth=0,i.originalHeight=0,i.livePreviewRotationAngle=0,v(),s.disabled=!0,b.disabled=!e.some(e=>e.image)||"undefined"==typeof WebP||void 0===WebP.Encoder,E(),o.textContent=`${i.name} image removed.`)}),[m,g,c].forEach(i=>{i.addEventListener("input",()=>(function(i){let n=e[t];if(!n)return;let a=i.id,l=i.value;"number"===i.type&&isNaN(l=parseFloat(l))&&("finalVerticalSize"===a?l=null:"degreesPerFrame"===a?l=0:"opacity"===a&&(l=100)),"degreesPerFrame"===a?n.settings.degreesPerFrame=l:"finalVerticalSize"===a?n.settings.finalVerticalSize=null===l||isNaN(parseFloat(l))?n.image?n.originalHeight:null:parseFloat(l):"opacity"===a&&(n.settings.opacity=Math.max(0,Math.min(100,parseFloat(l)||100))),("degreesPerFrame"===a||"opacity"===a)&&C(),("finalVerticalSize"===a||"opacity"===a)&&E()})(i))}),[u,f,p].forEach(t=>{t.addEventListener("input",()=>{t===f&&e.some(e=>e.image)&&C()})}),b.addEventListener("click",async()=>{if("undefined"==typeof WebP||void 0===WebP.Encoder){y.innerHTML="<span class='text-red-500 font-bold'>CRITICAL ERROR: WebP encoding library ('webp-wasm.js' if local, or npm install) not found or failed to load. Animated export is disabled.</span>",console.error("WebP or WebP.Encoder is undefined. Library might not have initialized correctly.");return}if(0===e.filter(e=>e.image).length){y.textContent="No images to export.";return}y.textContent="Preparing animated WebP export...",h.classList.remove("hidden"),b.disabled=!0,await new Promise(e=>setTimeout(e,100));try{let t=parseInt(u.value)||36,i=parseFloat(f.value)||83.3,n=parseInt(p.value)||75;if(t<1){y.textContent="Total export frames must be at least 1.",h.classList.add("hidden"),b.disabled=!1;return}let a=document.createElement("canvas");a.width=1600,a.height=1600;let l=a.getContext("2d"),o=new WebP.Encoder(a.width,a.height,{quality:n,lossless:!1});o.setLoops(0);for(let n=0;n<t;n++){l.clearRect(0,0,a.width,a.height);for(let t=5;t>=0;t--){let i=e[t];if(!i.image)continue;let o=n*(i.settings.degreesPerFrame||0),r=i.settings.finalVerticalSize||i.originalHeight;r<=0&&(r=i.originalHeight);let d=i.originalWidth>0&&i.originalHeight>0?i.originalWidth/i.originalHeight:1,s=r*d;(s>1580||r>1580)&&(d>=1?(s=1580,r=1580/d):(r=1580,s=1580*d)),l.save(),l.globalAlpha=i.settings.opacity/100,l.translate(a.width/2,a.height/2),l.rotate(o*Math.PI/180),l.drawImage(i.image,-s/2,-r/2,s,r),l.restore()}l.globalAlpha=1,o.addFrame(l,i),y.textContent=`Encoding frame ${n+1} of ${t}...`,n%5==0&&n>0&&await new Promise(e=>setTimeout(e,0))}y.textContent="Finalizing WebP animation...",await new Promise(e=>setTimeout(e,50));let r=o.finish();o.release();let d=new Blob([r],{type:"image/webp"}),s=URL.createObjectURL(d),m=document.createElement("a");m.href=s,m.download=`spinner_animation_${Date.now()}.webp`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(s),y.innerHTML=`Animated WebP exported successfully! (${t} frames)`,y.className="text-sm text-center text-green-700 mt-2 font-semibold"}catch(e){console.error("Error during WebP export:",e),y.textContent="Error during WebP export. Check console.",y.className="text-sm text-center text-red-600 mt-2"}finally{h.classList.add("hidden"),b.disabled=!e.some(e=>e.image)||"undefined"==typeof WebP||void 0===WebP.Encoder}}),e=[];for(let t=0;t<6;t++)e.push({id:t,name:`Object ${t+1}`,image:null,fileName:null,originalWidth:0,originalHeight:0,settings:{degreesPerFrame:10,finalVerticalSize:null,opacity:100},livePreviewRotationAngle:0});v(),w(0),b.disabled=!0});
//# sourceMappingURL=Spinner-App.5342adde.js.map
